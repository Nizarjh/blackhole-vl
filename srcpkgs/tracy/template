# Template file for 'tracy'
pkgname=tracy
version=0.13.1
revision=1
build_style=cmake
hostmakedepends="pkg-config git cmake"
makedepends="pugixml-devel capstone-devel wayland-devel libglvnd-devel libxkbcommon-devel freetype-devel dbus-devel openssl-devel libcurl-devel libtidy5-devel libgomp-devel json-c++ libmd4c-devel"
depends="pugixml wayland libglvnd libxkbcommon freetype dbus hicolor-icon-theme"
short_desc="Frame profiler"
maintainer="Kirilla <kirill39.pesin@ya.ru>"
license="BSD-3-Clause"
homepage="https://github.com/wolfpld/tracy"
distfiles="https://github.com/wolfpld/tracy/archive/v${version}.tar.gz"
checksum=d4efc50ebcb0bfcfdbba148995aeb75044c0d80f5d91223aebfaa8fa9e563d2b

do_configure() {
	cmake -B build-client -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr ${CMAKE_CONF_ARGS}

	cmake -S capture -B build-capture -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr ${CMAKE_CONF_ARGS}

	cmake -S csvexport -B build-csvexport -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr ${CMAKE_CONF_ARGS}

	cmake -S import -B build-import -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr ${CMAKE_CONF_ARGS}

	cmake -S profiler -B build-profiler -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr ${CMAKE_CONF_ARGS}

	cmake -S update -B build-update -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr ${CMAKE_CONF_ARGS}
}
do_build() {
	make -C build-client ${makejobs}
	make -C build-capture ${makejobs}
	make -C build-csvexport ${makejobs}
	make -C build-import ${makejobs}
	make -C build-profiler ${makejobs}
	make -C build-update ${makejobs}
}

do_install() {
	vinstall build-client/libTracyClient.a 644 usr/lib/

	vbin build-capture/tracy-capture
	vbin build-csvexport/tracy-csvexport
	vbin build-import/tracy-import-chrome
	vbin build-import/tracy-import-fuchsia
	vbin build-profiler/tracy-profiler usr/bin/tracy
	vbin build-update/tracy-update

	for header in public/client/*.{h,hpp}; do
		vinstall "${header}" 644 usr/include/Tracy/client/
	done
	for header in public/common/*.{h,hpp}; do
		vinstall "${header}" 644 usr/include/Tracy/common/
	done
	for header in public/tracy/*.{h,hpp}; do
		vinstall "${header}" 644 usr/include/Tracy/tracy/
	done

	vinstall extra/desktop/tracy.desktop 644 usr/share/applications/
	vinstall icon/icon.svg 644 usr/share/icons/hicolor/scalable/apps/ tracy.svg
	vinstall extra/desktop/application-tracy.xml 644 usr/share/mime/packages/
	vinstall icon/application-tracy.svg 644 usr/share/icons/hicolor/scalable/apps/
}

post_install() {
	vlicense LICENSE
}
